version: "3.1"
flows:
  replace_eligible_card:
    description: the user needs to replace their eligible card
    if: False
    name: replace eligible card
    steps:
      - collect: replacement_reason
        next:
          - if: slots.replacement_reason = "lost"
            then:
              - collect: was_card_used_fraudulently
                ask_before_filling: true
                next:
                  - if: slots.was_card_used_fraudulently
                    then:
                    - collect: lock_card
                      ask_before_filling: true
                      next:
                        - if: slots.lock_card
                          then:
                            - action: utter_card_locked
                              next: connect_to_specialist
                        - else: connect_to_specialist_lost
                    - id: connect_to_specialist_lost
                      action: utter_connect_to_specialist
                      next: END
                  - else: start_replacement
          - if: slots.replacement_reason = "damaged"
            then:
              - action: utter_sorry_damaged
                next:
                - if: slots.num_cards = 2
                  then:
                    - collect: whos_card
                    # TODO: flow not followed after this point
                    - action: utter_start_damage_replacement
                    - call: confirm_address
                      next: END
                - if: slots.num_cards = 1
                  then:
                    - action: utter_start_damage_replacement
                    - call: confirm_address
                      next: END
                - else:
                    - action: utter_start_damage_replacement
                    - action: utter_replacement_sent_to_authorized_user
                    - call: confirm_address
                      next: END
          - if: slots.replacement_reason = "never_received"
            then:
              - action: action_days_since_card_sent
                next:
                  - if: slots.days_since_card_sent > 7
                    then: start_replacement
                  - else:
                    - action: utter_card_recently_sent
                      next: END
          - if: slots.replacement_reason = "stolen"
            then:
              - collect: lock_card
                ask_before_filling: true
                next:
                  - if: slots.lock_card
                    then:
                      - action: utter_card_locked
                        next: connect_to_specialist
                  - else: connect_to_specialist
              - id: connect_to_specialist
                action: utter_connect_to_specialist
                next: END
          - else:
            - action: utter_unknown_replacement_reason_handover
              next: END
      - id: start_replacement
        action: utter_will_cancel_and_send_new
      - action: utter_new_card_has_been_ordered
