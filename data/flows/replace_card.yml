flows:
  replace_card:
    description: the user needs to replace their card
    name: replace_card
    nlu_trigger:
      - intent:
          name: replace_card
          confidence_threshold: 0.9
    steps:
      - collect: confirm_correct_card
        next:
          - if: slots.confirm_correct_card
            then:
              - noop:
                next:
                - if: slots.cardholder_replacement_eligibility = 'not_eligible_child'
                  then:
                    - action: utter_ineligible_child_card
                      next: END
                - if: slots.cardholder_replacement_eligibility = 'no_card_on_file'
                  then:
                    - link: no_eligible_card
                - else:
                    - call: replace_eligible_card
                      next: END
          - else:
              - noop:
                next:
                - if: slots.num_cards = 1
                  then:
                  - action: utter_relevant_card_not_linked
                    next: END
                - else:
                  - call: select_card
                    next:
                    - if: slots.cardholder_replacement_eligibility = 'not_eligible_child'
                      then:
                        - action: utter_ineligible_child_card
                          next: END
                    - if: slots.cardholder_replacement_eligibility = 'no_card_on_file'
                      then:
                        - link: no_eligible_card
                    - else:
                        - call: replace_eligible_card
                          next: END
